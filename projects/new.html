<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background-color: #f4f7fa;
            color: #bc3030;
        }
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 36px;
        }
        h2 {
            color: #1d1ae8;
            text-align: center;
            margin-bottom: 30px;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #e0e0e0;
            background-color: #ffffff;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .tab button {
            background-color: #ffffff;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: background-color 0.3s, color 0.3s;
            font-weight: 500;
            color: #555;
        }
        .tab button:hover {
            background-color: #e8f0fe;
            color: #1a73e8;
        }
        .tab button.active {
            background-color: #1a73e8;
            color: #ffffff;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-top: none;
            background-color: #ffffff;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #ffffff;
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #1a73e8;
            color: #ffffff;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        tr:hover {
            background-color: #e8f0fe;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: inline-block;
            width: 150px;
            font-weight: 500;
            color: #333;
        }
        .form-group input, .form-group select {
            width: 200px;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: #1a73e8;
            outline: none;
            box-shadow: 0 0 5px rgba(26, 115, 232, 0.3);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.1s;
        }
        button:not(.tablinks) {
            background-color: #1a73e8;
            color: #ffffff;
        }
        button:not(.tablinks):hover {
            background-color: #1557b0;
            transform: translateY(-1px);
        }
        button:not(.tablinks):active {
            transform: translateY(0);
        }
        button[onclick*='cancelForm'], button[onclick*='deleteAll'], button[onclick*='deleteRow'] {
            background-color: #e57373;
        }
        button[onclick*='cancelForm']:hover, button[onclick*='deleteAll']:hover, button[onclick*='deleteRow']:hover {
            background-color: #d32f2f;
        }
        button[onclick*='editRow'] {
            background-color: #26a69a;
        }
        button[onclick*='editRow']:hover {
            background-color: #1e857b;
        }
    </style>
</head>
<body>
    <h1> WELCOME </h1>
    <h2> Shree Rajeshwar Nidhi Secondary School Nagarain-2, Dhanusha, Nepal </h2>
    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'Students')">Students</button>
        <button class="tablinks" onclick="openTab(event, 'Guardians')">Guardians</button>
        <button class="tablinks" onclick="openTab(event, 'Teachers')">Teachers</button>
        <button class="tablinks" onclick="openTab(event, 'TeachingRoutine')">Teaching Routine</button>
    </div>

    <!-- Students Tab -->
    <div id="Students" class="tabcontent">
        <h2>Students</h2>
        <div>
            <button onclick="showAddForm('student')">Add Student</button>
            <button onclick="sortTable('students', 'first_name')">Sort by First Name</button>
            <button onclick="viewTable('students')">View All</button>
        </div>
        <div id="studentForm" style="display:none;">
            <h3>Add/Update Student</h3>
            <div class="form-group">
                <label>Student ID:</label>
                <input type="text" id="student_id" readonly>
            </div>
            <div class="form-group">
                <label>Roll No:</label>
                <input type="text" id="roll_no">
            </div>
            <div class="form-group">
                <label>First Name:</label>
                <input type="text" id="first_name">
            </div>
            <div class="form-group">
                <label>Middle Name:</label>
                <input type="text" id="middle_name">
            </div>
            <div class="form-group">
                <label>Last Name:</label>
                <input type="text" id="last_name">
            </div>
            <div class="form-group">
                <label>Class:</label>
                <input type="text" id="class">
            </div>
            <div class="form-group">
                <label>Date of Birth:</label>
                <input type="date" id="dob">
            </div>
            <div class="form-group">
                <label>Contact No:</label>
                <input type="text" id="contact_no">
            </div>
            <div class="form-group">
                <label>Address:</label>
                <input type="text" id="address">
            </div>
            <div class="form-group">
                <label>Age:</label>
                <input type="number" id="age">
            </div>
            <div class="form-group">
                <label>Gender:</label>
                <select id="gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Marks (JSON):</label>
                <input type="text" id="marks" placeholder='{"Math": 90, "Science": 85}'>
            </div>
            <button onclick="saveStudent()">Save</button>
            <button onclick="cancelForm('studentForm')">Cancel</button>
        </div>
        <table id="studentsTable">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Roll No</th>
                    <th>First Name</th>
                    <th>Middle Name</th>
                    <th>Last Name</th>
                    <th>Class</th>
                    <th>DOB</th>
                    <th>Contact No</th>
                    <th>Address</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Marks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="studentsBody"></tbody>
        </table>
    </div>

    <!-- Guardians Tab -->
    <div id="Guardians" class="tabcontent">
        <h2>Guardians</h2>
        <div>
            <button onclick="showAddForm('guardian')">Add Guardian</button>
            <button onclick="sortTable('guardians', 'father_name')">Sort by Father Name</button>
            <button onclick="viewTable('guardians')">View All</button>
        </div>
        <div id="guardianForm" style="display:none;">
            <h3>Add/Update Guardian</h3>
            <div class="form-group">
                <label>Student ID:</label>
                <input type="text" id="guardian_student_id">
            </div>
            <div class="form-group">
                <label>Father Name:</label>
                <input type="text" id="father_name">
            </div>
            <div class="form-group">
                <label>Mother Name:</label>
                <input type="text" id="mother_name">
            </div>
            <div class="form-group">
                <label>Contact No:</label>
                <input type="text" id="guardian_contact_no">
            </div>
            <div class="form-group">
                <label>Address:</label>
                <input type="text" id="guardian_address">
            </div>
            <button onclick="saveGuardian()">Save</button>
            <button onclick="cancelForm('guardianForm')">Cancel</button>
        </div>
        <table id="guardiansTable">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Father Name</th>
                    <th>Mother Name</th>
                    <th>Contact No</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="guardiansBody"></tbody>
        </table>
    </div>

    <!-- Teachers Tab -->
    <div id="Teachers" class="tabcontent">
        <h2>Teachers</h2>
        <div>
            <button onclick="showAddForm('teacher')">Add Teacher</button>
            <button onclick="sortTable('teachers', 'teacher_name')">Sort by Name</button>
            <button onclick="viewTable('teachers')">View All</button>
        </div>
        <div id="teacherForm" style="display:none;">
            <h3>Add/Update Teacher</h3>
            <div class="form-group">
                <label>Teacher ID:</label>
                <input type="text" id="teacher_id" readonly>
            </div>
            <div class="form-group">
                <label>Teacher Name:</label>
                <input type="text" id="teacher_name">
            </div>
            <div class="form-group">
                <label>Address:</label>
                <input type="text" id="teacher_address">
            </div>
            <div class="form-group">
                <label>Age:</label>
                <input type="number" id="teacher_age">
            </div>
            <div class="form-group">
                <label>Contact No:</label>
                <input type="text" id="teacher_contact_no">
            </div>
            <div class="form-group">
                <label>Gender:</label>
                <select id="teacher_gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <button onclick="saveTeacher()">Save</button>
            <button onclick="cancelForm('teacherForm')">Cancel</button>
        </div>
        <table id="teachersTable">
            <thead>
                <tr>
                    <th>Teacher ID</th>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Age</th>
                    <th>Contact No</th>
                    <th>Gender</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="teachersBody"></tbody>
        </table>
    </div>

    <!-- Teaching Routine Tab -->
    <div id="TeachingRoutine" class="tabcontent">
        <h2>Teaching Routine</h2>
        <div>
            <button onclick="showAddForm('routine')">Add Routine</button>
            <button onclick="sortTable('teaching_routine', 'teacher_name')">Sort by Teacher Name</button>
            <button onclick="viewTable('teaching_routine')">View All</button>
        </div>
        <div id="routineForm" style="display:none;">
            <h3>Add/Update Routine</h3>
            <div class="form-group">
                <label>Teacher ID:</label>
                <input type="text" id="routine_teacher_id">
            </div>
            <div class="form-group">
                <label>Teacher Name:</label>
                <input type="text" id="routine_teacher_name">
            </div>
            <div class="form-group">
                <label>Teaching Subject:</label>
                <input type="text" id="teaching_subject">
            </div>
            <div class="form-group">
                <label>Teaching Class:</label>
                <input type="text" id="teaching_class">
            </div>
            <div class="form-group">
                <label>Class Time:</label>
                <input type="text" id="teaching_class_time">
            </div>
            <button onclick="saveRoutine()">Save</button>
            <button onclick="cancelForm('routineForm')">Cancel</button>
        </div>
        <table id="routineTable">
            <thead>
                <tr>
                    <th>Teacher ID</th>
                    <th>Teacher Name</th>
                    <th>Subject</th>
                    <th>Class</th>
                    <th>Class Time</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="routineBody"></tbody>
        </table>
    </div>

    <script>
        let db;

        async function initDB() {
            const SQL = await initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}` });
            db = new SQL.Database();

            // Create tables
            db.run(`
                CREATE TABLE students (
                    student_id TEXT PRIMARY KEY,
                    roll_no TEXT,
                    first_name TEXT,
                    middle_name TEXT,
                    last_name TEXT,
                    class TEXT,
                    dob TEXT,
                    contact_no TEXT,
                    address TEXT,
                    age INTEGER,
                    gender TEXT,
                    marks TEXT
                );
                CREATE TABLE guardians (
                    student_id TEXT PRIMARY KEY,
                    father_name TEXT,
                    mother_name TEXT,
                    contact_no TEXT,
                    address TEXT,
                    FOREIGN KEY (student_id) REFERENCES students(student_id)
                );
                CREATE TABLE teachers (
                    teacher_id TEXT PRIMARY KEY,
                    teacher_name TEXT,
                    address TEXT,
                    age INTEGER,
                    contact_no TEXT,
                    gender TEXT
                );
                CREATE TABLE teaching_routine (
                    teacher_id TEXT,
                    teacher_name TEXT,
                    teaching_subject TEXT,
                    teaching_class TEXT,
                    teaching_class_time TEXT,
                    PRIMARY KEY (teacher_id, teaching_class, teaching_class_time),
                    FOREIGN KEY (teacher_id) REFERENCES teachers(teacher_id)
                );
            `);
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            viewTable(tabName.toLowerCase());
        }

        function showAddForm(type) {
            document.getElementById(`${type}Form`).style.display = 'block';
            document.getElementById(`${type}_id`).value = type === 'student' || type === 'teacher' ? generateUUID() : '';
            clearForm(type);
        }

        function clearForm(type) {
            const form = document.getElementById(`${type}Form`);
            const inputs = form.getElementsByTagName('input');
            for (let input of inputs) {
                if (!input.readonly) input.value = '';
            }
            const selects = form.getElementsByTagName('select');
            for (let select of selects) {
                select.selectedIndex = 0;
            }
        }

        function cancelForm(formId) {
            document.getElementById(formId).style.display = 'none';
            clearForm(formId.replace('Form', ''));
        }

        function saveStudent() {
            const student_id = document.getElementById('student_id').value;
            const roll_no = document.getElementById('roll_no').value;
            const first_name = document.getElementById('first_name').value;
            const middle_name = document.getElementById('middle_name').value;
            const last_name = document.getElementById('last_name').value;
            const class_ = document.getElementById('class').value;
            const dob = document.getElementById('dob').value;
            const contact_no = document.getElementById('contact_no').value;
            const address = document.getElementById('address').value;
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const marks = document.getElementById('marks').value;

            const stmt = db.prepare(`
                INSERT OR REPLACE INTO students (student_id, roll_no, first_name, middle_name, last_name, class, dob, contact_no, address, age, gender, marks)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            `);
            stmt.run([student_id, roll_no, first_name, middle_name, last_name, class_, dob, contact_no, address, age, gender, marks]);
            stmt.free();
            cancelForm('studentForm');
            viewTable('students');
        }

        function saveGuardian() {
            const student_id = document.getElementById('guardian_student_id').value;
            const father_name = document.getElementById('father_name').value;
            const mother_name = document.getElementById('mother_name').value;
            const contact_no = document.getElementById('guardian_contact_no').value;
            const address = document.getElementById('guardian_address').value;

            const stmt = db.prepare(`
                INSERT OR REPLACE INTO guardians (student_id, father_name, mother_name, contact_no, address)
                VALUES (?, ?, ?, ?, ?)
            `);
            stmt.run([student_id, father_name, mother_name, contact_no, address]);
            stmt.free();
            cancelForm('guardianForm');
            viewTable('guardians');
        }

        function saveTeacher() {
            const teacher_id = document.getElementById('teacher_id').value;
            const teacher_name = document.getElementById('teacher_name').value;
            const address = document.getElementById('teacher_address').value;
            const age = document.getElementById('teacher_age').value;
            const contact_no = document.getElementById('teacher_contact_no').value;
            const gender = document.getElementById('teacher_gender').value;

            const stmt = db.prepare(`
                INSERT OR REPLACE INTO teachers (teacher_id, teacher_name, address, age, contact_no, gender)
                VALUES (?, ?, ?, ?, ?, ?)
            `);
            stmt.run([teacher_id, teacher_name, address, age, contact_no, gender]);
            stmt.free();
            cancelForm('teacherForm');
            viewTable('teachers');
        }

        function saveRoutine() {
            const teacher_id = document.getElementById('routine_teacher_id').value;
            const teacher_name = document.getElementById('routine_teacher_name').value;
            const teaching_subject = document.getElementById('teaching_subject').value;
            const teaching_class = document.getElementById('teaching_class').value;
            const teaching_class_time = document.getElementById('teaching_class_time').value;

            const stmt = db.prepare(`
                INSERT OR REPLACE INTO teaching_routine (teacher_id, teacher_name, teaching_subject, teaching_class, teaching_class_time)
                VALUES (?, ?, ?, ?, ?)
            `);
            stmt.run([teacher_id, teacher_name, teaching_subject, teaching_class, teaching_class_time]);
            stmt.free();
            cancelForm('routineForm');
            viewTable('teaching_routine');
        }

        function viewTable(tableName) {
            let query;
            let headers;
            let bodyId;
            switch (tableName) {
                case 'students':
                    query = 'SELECT * FROM students';
                    headers = ['student_id', 'roll_no', 'first_name', 'middle_name', 'last_name', 'class', 'dob', 'contact_no', 'address', 'age', 'gender', 'marks'];
                    bodyId = 'studentsBody';
                    break;
                case 'guardians':
                    query = 'SELECT * FROM guardians';
                    headers = ['student_id', 'father_name', 'mother_name', 'contact_no', 'address'];
                    bodyId = 'guardiansBody';
                    break;
                case 'teachers':
                    query = 'SELECT * FROM teachers';
                    headers = ['teacher_id', 'teacher_name', 'address', 'age', 'contact_no', 'gender'];
                    bodyId = 'teachersBody';
                    break;
                case 'teaching_routine':
                    query = 'SELECT * FROM teaching_routine';
                    headers = ['teacher_id', 'teacher_name', 'teaching_subject', 'teaching_class', 'teaching_class_time'];
                    bodyId = 'routineBody';
                    break;
            }

            const results = db.exec(query);
            const tbody = document.getElementById(bodyId);
            tbody.innerHTML = '';
            if (results.length > 0) {
                for (let row of results[0].values) {
                    const tr = document.createElement('tr');
                    for (let i = 0; i < row.length; i++) {
                        const td = document.createElement('td');
                        td.textContent = row[i] || '';
                        tr.appendChild(td);
                    }
                    const actionTd = document.createElement('td');
                    actionTd.innerHTML = `
                        <button onclick="editRow('${tableName}', '${row[0]}')">Edit</button>
                        <button onclick="deleteRow('${tableName}', '${row[0]}')">Delete</button>
                    `;
                    tr.appendChild(actionTd);
                    tbody.appendChild(tr);
                }
            }
        }

        function editRow(tableName, id) {
            let query;
            let formId;
            switch (tableName) {
                case 'students':
                    query = `SELECT * FROM students WHERE student_id = ?`;
                    formId = 'studentForm';
                    break;
                case 'guardians':
                    query = `SELECT * FROM guardians WHERE student_id = ?`;
                    formId = 'guardianForm';
                    break;
                case 'teachers':
                    query = `SELECT * FROM teachers WHERE teacher_id = ?`;
                    formId = 'teacherForm';
                    break;
                case 'teaching_routine':
                    query = `SELECT * FROM teaching_routine WHERE teacher_id = ?`;
                    formId = 'routineForm';
                    break;
            }

            const stmt = db.prepare(query);
            stmt.bind([id]);
            if (stmt.step()) {
                const row = stmt.get();
                document.getElementById(formId).style.display = 'block';
                const inputs = document.getElementById(formId).getElementsByTagName('input');
                const selects = document.getElementById(formId).getElementsByTagName('select');
                let index = 0;
                for (let input of inputs) {
                    if (!input.readonly) {
                        input.value = row[index++] || '';
                    } else {
                        input.value = id;
                    }
                }
                for (let select of selects) {
                    select.value = row[index++] || '';
                }
            }
            stmt.free();
        }

        function deleteRow(tableName, id) {
            let query;
            switch (tableName) {
                case 'students':
                    query = `DELETE FROM students WHERE student_id = ?`;
                    break;
                case 'guardians':
                    query = `DELETE FROM guardians WHERE student_id = ?`;
                    break;
                case 'teachers':
                    query = `DELETE FROM teachers WHERE teacher_id = ?`;
                    break;
                case 'teaching_routine':
                    query = `DELETE FROM teaching_routine WHERE teacher_id = ?`;
                    break;
            }
            const stmt = db.prepare(query);
            stmt.run([id]);
            stmt.free();
            viewTable(tableName);
        }

        function sortTable(tableName, column) {
            let query;
            let headers;
            let bodyId;
            switch (tableName) {
                case 'students':
                    query = `SELECT * FROM students ORDER BY ${column}`;
                    headers = ['student_id', 'roll_no', 'first_name', 'middle_name', 'last_name', 'class', 'dob', 'contact_no', 'address', 'age', 'gender', 'marks'];
                    bodyId = 'studentsBody';
                    break;
                case 'guardians':
                    query = `SELECT * FROM guardians ORDER BY ${column}`;
                    headers = ['student_id', 'father_name', 'mother_name', 'contact_no', 'address'];
                    bodyId = 'guardiansBody';
                    break;
                case 'teachers':
                    query = `SELECT * FROM teachers ORDER BY ${column}`;
                    headers = ['teacher_id', 'teacher_name', 'address', 'age', 'contact_no', 'gender'];
                    bodyId = 'teachersBody';
                    break;
                case 'teaching_routine':
                    query = `SELECT * FROM teaching_routine ORDER BY ${column}`;
                    headers = ['teacher_id', 'teacher_name', 'teaching_subject', 'teaching_class', 'teaching_class_time'];
                    bodyId = 'routineBody';
                    break;
            }

            const results = db.exec(query);
            const tbody = document.getElementById(bodyId);
            tbody.innerHTML = '';
            if (results.length > 0) {
                for (let row of results[0].values) {
                    const tr = document.createElement('tr');
                    for (let i = 0; i < row.length; i++) {
                        const td = document.createElement('td');
                        td.textContent = row[i] || '';
                        tr.appendChild(td);
                    }
                    const actionTd = document.createElement('td');
                    actionTd.innerHTML = `
                        <button onclick="editRow('${tableName}', '${row[0]}')">Edit</button>
                        <button onclick="deleteRow('${tableName}', '${row[0]}')">Delete</button>
                    `;
                    tr.appendChild(actionTd);
                    tbody.appendChild(tr);
                }
            }
        }

        // Initialize the database and open the first tab
        initDB().then(() => {
            document.getElementById('Students').style.display = 'block';
            document.getElementsByClassName('tablinks')[0].className += ' active';
            viewTable('students');
        });
    </script>
</body>
</html>